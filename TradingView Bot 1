//@version=4
// Bollinger Bands and Fibonacci Retracements Crypto Trading Strategy
// Using LUNC and BUSD

// Bollinger Bands settings
bb_length = 20
bb_std = 2

// Fibonacci retracement levels
fib_levels = [0, 0.236, 0.382, 0.5, 0.618, 0.786, 1]

// Define the main strategy function
strategy("Bollinger Bands and Fibonacci Retracements Strategy", shorttitle="BB+Fib Strategy", overlay=true, initial_capital=10000)

// Get the Bollinger Bands for LUNC
bb_lunc = bollinger(syminfo.ticker, length=bb_length, stddev=bb_std)

// Get the Fibonacci retracement levels for LUNC
fib_lunc = fibonacci(syminfo.ticker, levels=fib_levels)

// Get the Bollinger Bands for BUSD
bb_busd = bollinger(syminfo.ticker, length=bb_length, stddev=bb_std, src=close, symbol="BUSD")

// Get the Fibonacci retracement levels for BUSD
fib_busd = fibonacci(syminfo.ticker, levels=fib_levels, src=close, symbol="BUSD")

// Plot the Bollinger Bands for LUNC
plot(bb_lunc.middle, title="BB Middle Band (LUNC)", color=blue)
plot(bb_lunc.upper, title="BB Upper Band (LUNC)", color=red)
plot(bb_lunc.lower, title="BB Lower Band (LUNC)", color=green)

// Plot the Fibonacci retracement levels for LUNC
plot(fib_lunc.fib_0, title="Fib 0% (LUNC)", color=purple, linewidth=2, style=circles)
plot(fib_lunc.fib_236, title="Fib 23.6% (LUNC)", color=purple, linewidth=2, style=circles)
plot(fib_lunc.fib_382, title="Fib 38.2% (LUNC)", color=purple, linewidth=2, style=circles)
plot(fib_lunc.fib_5, title="Fib 50% (LUNC)", color=purple, linewidth=2, style=circles)
plot(fib_lunc.fib_618, title="Fib 61.8% (LUNC)", color=purple, linewidth=2, style=circles)
plot(fib_lunc.fib_786, title="Fib 78.6% (LUNC)", color=purple, linewidth=2, style=circles)
plot(fib_lunc.fib_1, title="Fib 100% (LUNC)", color=purple, linewidth=2, style=circles)

// Plot the Bollinger Bands for BUSD
plot(bb_busd.middle, title="BB Middle Band (BUSD)", color=blue, linewidth=2, linestyle=dashed)
plot(bb_busd.upper, title="BB Upper Band (BUSD)", color=red, linewidth=2, linestyle=dashed)
plot(bb_busd.lower, title="BB Lower Band (BUSD)", color=green, linewidth=2, linestyle=dashed)

// Plot the Fibonacci retracement levels for BUSD
plot(fib_busd.fib_0, title="Fib 0% (BUSD)", color=purple, linewidth=2, style=circles, linestyle=dashed)
plot(fib_busd.fib_236, title="Fib 23.6% (BUSD)", color=purple, linewidth=2, style=circles, linestyle=dashed)
plot(fib_busd.fib_382, title="Fib 38.2% (BUSD)", color=purple, linewidth=2, style=circles, linestyle=dashed)
plot(fib_busd.fib_5, title="Fib 50% (BUSD)", color=purple, linewidth=2, style=circles, linestyle=dashed)
plot(fib_busd.fib_618, title="Fib 61.8% (BUSD)", color=purple, linewidth=2, style=circles, linestyle=dashed)
plot(fib_busd.fib_786, title="Fib 78.6% (BUSD)", color=purple, linewidth=2, style=circles, linestyle=dashed)
plot(fib_busd.fib_1, title="Fib 100% (BUSD)", color=purple, linewidth=2, style=circles, linestyle=dashed)

// Define the buy and sell conditions for LUNC
buy_lunc = crossover(close, bb_lunc.lower)
sell_lunc = crossunder(close, bb_lunc.upper)

// Define the buy and sell conditions for BUSD
buy_busd = crossover(close, bb_busd.lower)
sell_busd = crossunder(close, bb_busd.upper)

// Use the strategy function to define the buy and sell orders
strategy.entry("Long LUNC", strategy.long, when=buy_lunc)
strategy.exit("Close Long LUNC", strategy.long, when=sell_lunc)
strategy.entry("Long BUSD", strategy.long, when=buy_busd)
strategy.exit("Close Long BUSD", strategy.long, when=sell_busd)
